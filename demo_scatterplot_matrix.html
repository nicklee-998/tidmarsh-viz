<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<link rel="stylesheet" type="text/css" href="./scripts2/css/scatter_plot_matrix.css"/>
	<style type="text/css">

		html {
			background-color: rgba(32, 36, 40, 1);
		}

	</style>
</head>
<body>
<h2 style="font-size:24px;">Tidmarsh Sensor Scatterplot</h2>
<div id="scatterplot_cont"></div>

<script src="./libs/jquery-1.11.1.min.js"></script>
<script src="./libs/d3.js"></script>
<script src="scripts2/view/ScatterPlotGraph.js"></script>
<script>

	const SITE_URL = "http://chain-api.media.mit.edu/devices/?site_id=7";

	var devices;
	var graph;

	$(document).ready(function() {
		$.getJSON(SITE_URL, function(dat) {

			// TODO: That's use a little trick way to get all sensors from on request, maybe change the way in future...
			var url = SITE_URL + '&limit=' + dat.totalCount + '&offset=0';
			$.getJSON(url, function(dat2) {
				devices = dat2["_links"]["items"];

				graph = new ScatterPlotGraph();
				graph.initDataset(devices, "2014");
			});
		});
	});

	/////////////////////////////////////////////
	// FOR TEST
	/////////////////////////////////////////////
	function onKeyboardDown()
	{
//		// 返回键退出
		if(d3.event.keyCode == 37) 		// LEFT
		{
			graph._start_time.setHours(graph._start_time.getHours() - 240);
			graph._end_time.setHours(graph._end_time.getHours() - 240);

			console.log(graph._start_time.toLocaleDateString() + " - " + graph._end_time.toLocaleDateString());
			graph.resetDate(graph._start_time, graph._end_time);
		}
		else if(d3.event.keyCode == 39) 	// RIGHT
		{
			graph._start_time.setHours(graph._start_time.getHours() + 240);
			graph._end_time.setHours(graph._end_time.getHours() + 240);

			console.log(graph._start_time.toLocaleDateString() + " - " + graph._end_time.toLocaleDateString());
			graph.resetDate(graph._start_time, graph._end_time);
		}
		else if(d3.event.keyCode == 38)
		{
			graph.highlightDevices(["0x8114"]);
		}
	}
	d3.select("body").on("keydown", onKeyboardDown);

</script>
</body>
</html>
